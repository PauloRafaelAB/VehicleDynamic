#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue May 23 11:26:40 2023

@author: roadview
"""

from scipy.interpolate import interp1d
from numpy.linalg import inv
import numpy as np

gear_selection= [[0, 5.555555556, 8.333333333, 11.11111111, 13.88888889, 16.66666667, 20.83333333, 27.7777777],
  [2.777777778, 5.555555556, 8.333333333, 11.11111111, 13.88888889, 16.66666667, 20.83333333, 27.77777778],
  [5.555555556, 9.722222222, 13.88888889, 18.05555556, 22.22222222, 27.77777778, 30.55555556, 41.66666667],
  [8.333333333, 13.88888889, 19.44444444, 25, 30.55555556, 38.88888889, 43.05555556, 55.55555556],
  [11.11111111, 18.05555556, 25, 31.94444444, 38.88888889, 50, 55.55555556, 69.44444444],
  [11.11111111, 22.22222222, 33.33333333, 41.66666667, 50, 58.33333333, 66.66666667, 75],
  [11.38888889, 22.5, 33.61111111, 41.94444444, 50.27777778, 58.61111111, 66.94444444, 75.27777778],
  [11.66666667, 22.77777778, 33.88888889, 42.22222222, 50.55555556, 58.88888889, 67.22222222, 75.55555556],
  [11.94444444, 23.05555556, 34.16666667, 42.5, 50.83333333, 59.16666667, 67.5, 75.83333333],
  [12.22222222, 23.33333333, 34.44444444, 42.77777778, 51.11111111, 59.44444444, 67.77777778, 76.11111111],
  [12.5, 23.61111111, 34.72222222, 43.05555556, 51.38888889, 59.72222222, 68.05555556, 76.38888889]]
gear_ratio = [5, 3.2, 2.14, 1.72, 1.31, 1, 0.82, 0.64]

for i in range(len(gear_ratio)): # checking number of gears
    if  acc[0] >= 0.0:
        #if  vx >   param.gear_selection[int(  throttle*10)][ vx]:  
        if  vx >   param.gear_selection[int(  throttle*10)][int( vx)]:
            if i >6:
                i=6
                gear =   gear_ratio[i+1]
    # Using an offset of upshift
    if  acc[0] <0:
        if  ( vx * 0.8) < gear_selection[int(  throttle*10)][int( vx)]:
              gear = gear_ratio[i]
    else:
          gear = gear_ratio[0]    # neutral    